<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ephemery Validator Performance Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #6a5acd;
            --secondary-color: #5a4abf;
            --accent-color: #7f73d1;
            --text-color: #333;
            --light-bg: #f5f7fa;
            --card-bg: #ffffff;
            --border-color: #e3e8ef;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --info-color: #2196f3;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light-bg);
            color: var(--text-color);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            margin: 0;
            display: flex;
            align-items: center;
            font-size: 1.8rem;
        }

        header h1 i {
            margin-right: 10px;
        }

        .dashboard-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .card-header h2 {
            margin: 0;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        .card-header .icon {
            font-size: 1.2rem;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--light-bg);
            color: var(--primary-color);
            border-radius: 50%;
        }

        .metric {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #666;
        }

        .metric-trend {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .metric-trend.up {
            color: var(--success-color);
        }

        .metric-trend.down {
            color: var(--danger-color);
        }

        .progress-container {
            margin-top: 10px;
        }

        .progress-bar {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 4px;
            transition: width 0.5s ease-in-out;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #666;
        }

        .charts-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .validators-list {
            margin-top: 20px;
        }

        .validators-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .validators-header h2 {
            margin: 0;
            color: var(--primary-color);
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 8px 15px 8px 35px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            outline: none;
            width: 250px;
            font-size: 0.9rem;
        }

        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--light-bg);
            color: var(--primary-color);
            font-weight: 600;
        }

        tr:hover {
            background-color: rgba(106, 90, 205, 0.05);
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-active {
            background-color: var(--success-color);
        }

        .status-pending {
            background-color: var(--warning-color);
        }

        .status-error {
            background-color: var(--danger-color);
        }

        .alerts-panel {
            margin-top: 20px;
        }

        .alert-card {
            background-color: #fff8e1;
            border-left: 4px solid var(--warning-color);
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 4px;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .alert-title {
            font-weight: 600;
            color: #ff8f00;
        }

        .alert-timestamp {
            font-size: 0.85rem;
            color: #999;
        }

        .alert-message {
            color: #5f4f2a;
        }

        .dashboard-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-button {
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background-color 0.3s;
        }

        .action-button:hover {
            background-color: var(--secondary-color);
        }

        .action-button i {
            margin-right: 8px;
        }

        footer {
            margin-top: 40px;
            text-align: center;
            color: #666;
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }

        .refresh-info {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        .refresh-info i {
            margin-right: 5px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .dashboard-summary {
                grid-template-columns: 1fr;
            }

            .charts-row {
                grid-template-columns: 1fr;
            }

            .search-box input {
                width: 100%;
            }

            .dashboard-actions {
                flex-direction: column;
            }
        }

        /* New enhanced styles */
        .dashboard-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .control-group {
            display: flex;
            gap: 10px;
        }

        .action-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .action-button i {
            margin-right: 8px;
        }

        .action-button:hover {
            background-color: var(--secondary-color);
        }

        .action-button.secondary {
            background-color: #f5f7fa;
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .action-button.secondary:hover {
            background-color: #e9ecf1;
        }

        .tab-container {
            margin-top: 20px;
        }

        .tab-nav {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .tab-link {
            padding: 10px 20px;
            cursor: pointer;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-link.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .alert-settings {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }

        .setting-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            flex: 1 0 200px;
        }

        .setting-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .setting-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
        }

        .setting-control input {
            width: 70px;
            padding: 5px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-success {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
        }

        .badge-warning {
            background-color: rgba(255, 152, 0, 0.1);
            color: var(--warning-color);
        }

        .badge-danger {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger-color);
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .validator-details {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .validator-details.active {
            display: block;
        }

        .details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .details-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .details-close {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .refresh-info {
            display: flex;
            align-items: center;
            font-size: 0.8rem;
            color: #666;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .charts-row {
                grid-template-columns: 1fr;
            }

            .dashboard-controls {
                flex-direction: column;
                align-items: flex-start;
            }

            .control-group {
                margin-top: 10px;
                width: 100%;
                justify-content: space-between;
            }

            .search-box input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-shield-alt"></i> Ephemery Validator Performance Dashboard</h1>
        </div>
    </header>

    <div class="container">
        <div class="refresh-info">
            <i class="fas fa-sync-alt"></i> Last updated: <span id="last-updated">Loading...</span> | Auto-refresh: <span id="refresh-countdown">30</span>s
        </div>

        <div class="dashboard-controls">
            <div class="control-group">
                <button id="refresh-button" class="action-button">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button id="performance-check" class="action-button">
                    <i class="fas fa-tachometer-alt"></i> Run Performance Check
                </button>
                <button id="export-data" class="action-button secondary">
                    <i class="fas fa-file-export"></i> Export Report
                </button>
                <button id="settings-button" class="action-button secondary">
                    <i class="fas fa-cog"></i> Settings
                </button>
            </div>
        </div>

        <div class="dashboard-summary">
            <div class="card">
                <div class="card-header">
                    <h2>Active Validators</h2>
                    <div class="icon">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="active-validators">--</div>
                    <div class="metric-label">Validators online</div>
                    <div class="metric-trend" id="validator-trend">
                        <i class="fas fa-arrow-up"></i> <span>+0 this week</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>Attestation Rate</h2>
                    <div class="icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="attestation-rate">--</div>
                    <div class="metric-label">Effectiveness</div>
                </div>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress" id="attestation-progress" style="width: 0%;"></div>
                    </div>
                    <div class="progress-stats">
                        <span>Target: 100%</span>
                        <span id="missed-attestations">0 missed</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>Average Balance</h2>
                    <div class="icon">
                        <i class="fas fa-coins"></i>
                    </div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="avg-balance">--</div>
                    <div class="metric-label">ETH per validator</div>
                    <div class="metric-trend" id="balance-trend">
                        <i class="fas fa-arrow-up"></i> <span>+0.00 this epoch</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>Recent Proposals</h2>
                    <div class="icon">
                        <i class="fas fa-cube"></i>
                    </div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="recent-proposals">--</div>
                    <div class="metric-label">Blocks proposed</div>
                    <div class="metric-trend" id="proposal-rate">
                        <span>0% success rate</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab navigation -->
        <div class="tab-container">
            <div class="tab-nav">
                <div class="tab-link active" data-tab="performance">Performance Metrics</div>
                <div class="tab-link" data-tab="alerts">Alerts <span id="alert-badge" class="badge badge-warning" style="display: none;">0</span></div>
                <div class="tab-link" data-tab="settings">Alert Settings</div>
            </div>

            <!-- Performance tab -->
            <div id="performance-tab" class="tab-content active">
                <div class="charts-row">
                    <div class="card">
                        <div class="card-header">
                            <h2>Balance History (30 Days)</h2>
                            <div class="icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="balance-chart"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>Attestation Performance</h2>
                            <div class="icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="attestation-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Advanced Performance Metrics -->
                <div class="performance-metrics">
                    <div class="card">
                        <div class="card-header">
                            <h2>Participation Rate</h2>
                            <div class="tooltip">
                                <i class="fas fa-info-circle"></i>
                                <span class="tooltiptext">Percentage of epochs where validators successfully participated</span>
                            </div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="participation-rate">--</div>
                            <div class="metric-label">last 50 epochs</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h2>Network Sync</h2>
                            <div class="tooltip">
                                <i class="fas fa-info-circle"></i>
                                <span class="tooltiptext">How well validators are in sync with the network</span>
                            </div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="network-sync">--</div>
                            <div class="metric-label">head distance (slots)</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h2>Inclusion Distance</h2>
                            <div class="tooltip">
                                <i class="fas fa-info-circle"></i>
                                <span class="tooltiptext">Average slots before attestations are included in a block</span>
                            </div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="inclusion-distance">--</div>
                            <div class="metric-label">average slots</div>
                        </div>
                    </div>
                </div>

                <div class="validators-list card">
                    <div class="validators-header">
                        <h2>Validator Performance</h2>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="validator-search" placeholder="Search validators...">
                        </div>
                    </div>

                    <table id="validators-table">
                        <thead>
                            <tr>
                                <th>Index</th>
                                <th>Status</th>
                                <th>Balance</th>
                                <th>Effectiveness</th>
                                <th>Last Attestation</th>
                                <th>Proposals</th>
                                <th>Sync Participation</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="validators-body">
                            <tr>
                                <td colspan="8" style="text-align: center;">Loading validator data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Alerts tab -->
            <div id="alerts-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2>Recent Alerts</h2>
                        <div class="icon">
                            <i class="fas fa-bell"></i>
                        </div>
                    </div>
                    <div id="alerts-container">
                        <div class="alert-card" style="margin-bottom: 15px; padding: 15px; border-left: 4px solid #f44336; background-color: #ffebee;">
                            <div class="alert-header" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <div class="alert-title" style="font-weight: 600; color: #d32f2f;">Loading alerts...</div>
                                <div class="alert-timestamp" style="font-size: 0.8rem; color: #666;">--</div>
                            </div>
                            <div class="alert-message" style="color: #333;">
                                Please wait while we fetch the latest alerts.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings tab -->
            <div id="settings-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2>Alert Settings</h2>
                        <div class="icon">
                            <i class="fas fa-bell"></i>
                        </div>
                    </div>
                    <p>Configure alert thresholds for validator monitoring.</p>

                    <div class="alert-settings">
                        <div class="setting-card">
                            <div class="setting-title">Attestation Rate Alert</div>
                            <p>Trigger an alert when attestation rate falls below threshold.</p>
                            <div class="setting-control">
                                <label for="attestation-threshold">Threshold (%)</label>
                                <input type="number" id="attestation-threshold" min="0" max="100" value="95">
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-title">Balance Decrease Alert</div>
                            <p>Trigger an alert when balance decreases by more than threshold.</p>
                            <div class="setting-control">
                                <label for="balance-threshold">Threshold (ETH)</label>
                                <input type="number" id="balance-threshold" min="0" step="0.01" value="0.01">
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-title">Missed Proposal Alert</div>
                            <p>Trigger an alert when a validator misses a block proposal.</p>
                            <div class="setting-control">
                                <label for="proposal-alert">Enable</label>
                                <input type="checkbox" id="proposal-alert" checked>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <button id="save-settings" class="action-button">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                        <button id="reset-settings" class="action-button secondary">
                            <i class="fas fa-undo"></i> Reset to Defaults
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Validator Details Panel (hidden by default) -->
        <div id="validator-details" class="validator-details">
            <div class="details-header">
                <div class="details-title">Validator Details: <span id="detail-validator-index">--</span></div>
                <button class="details-close" id="close-details">&times;</button>
            </div>
            <div id="validator-detail-content">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h3>Status Information</h3>
                        <p><strong>Status:</strong> <span id="detail-status">--</span></p>
                        <p><strong>Balance:</strong> <span id="detail-balance">--</span> ETH</p>
                        <p><strong>Effectiveness:</strong> <span id="detail-effectiveness">--</span>%</p>
                        <p><strong>Last Attestation:</strong> <span id="detail-last-attestation">--</span></p>
                    </div>
                    <div>
                        <h3>Performance Metrics</h3>
                        <p><strong>Proposals:</strong> <span id="detail-proposals">--</span></p>
                        <p><strong>Inclusion Distance:</strong> <span id="detail-inclusion">--</span> slots</p>
                        <p><strong>Sync Participation:</strong> <span id="detail-sync">--</span>%</p>
                        <p><strong>Network Head Distance:</strong> <span id="detail-head-distance">--</span> slots</p>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <h3>Balance History</h3>
                    <div class="chart-container">
                        <canvas id="detail-balance-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>Ephemery Validator Performance Dashboard | &copy; 2024 Ephemery Team</p>
        </div>
    </footer>

    <script>
        // Sample data for demonstration purposes
        // In a real implementation, this would be fetched from the API
        const mockData = {
            timestamp: new Date().toISOString(),
            active_validators: 128,
            attestation_rate: 98.7,
            avg_balance: 32.14,
            recent_proposals: 3,
            proposal_rate: 100,
            missed_attestations: 5,
            validator_trend: 4,
            balance_trend: 0.05,
            participation_rate: 99.2,
            network_sync: 1.2,
            inclusion_distance: 1.3,
            validators: [
                { index: 1, status: "active", balance: 32.14, effectiveness: 99.5, last_attestation: "2m ago", proposals: "1/1", sync_participation: 99.8 },
                { index: 2, status: "active", balance: 32.27, effectiveness: 100, last_attestation: "45s ago", proposals: "0/0", sync_participation: 100 },
                { index: 3, status: "active", balance: 31.98, effectiveness: 98.2, last_attestation: "1m ago", proposals: "1/1", sync_participation: 97.5 },
                { index: 4, status: "active", balance: 32.01, effectiveness: 99.8, last_attestation: "30s ago", proposals: "0/0", sync_participation: 99.3 },
                { index: 5, status: "active", balance: 32.08, effectiveness: 99.2, last_attestation: "1m ago", proposals: "1/1", sync_participation: 98.9 }
            ],
            alerts: [
                {
                    title: "Low Attestation Rate",
                    severity: "warning",
                    timestamp: "2024-03-12T15:30:00Z",
                    message: "Validator #3 has missed 5 attestations in the last 24 hours."
                },
                {
                    title: "Performance Warning",
                    severity: "info",
                    timestamp: "2024-03-12T09:15:00Z",
                    message: "Average balance for validator group is lower than network average by 0.15 ETH."
                }
            ],
            balance_history: [
                { date: "2024-02-12", value: 32.00 },
                { date: "2024-02-17", value: 32.03 },
                { date: "2024-02-22", value: 32.05 },
                { date: "2024-02-27", value: 32.08 },
                { date: "2024-03-04", value: 32.10 },
                { date: "2024-03-09", value: 32.12 },
                { date: "2024-03-14", value: 32.14 }
            ],
            attestation_history: [
                { date: "2024-03-08", value: 97.8 },
                { date: "2024-03-09", value: 98.2 },
                { date: "2024-03-10", value: 98.5 },
                { date: "2024-03-11", value: 99.1 },
                { date: "2024-03-12", value: 98.7 },
                { date: "2024-03-13", value: 98.9 },
                { date: "2024-03-14", value: 98.7 }
            ],
            validator_details: {
                1: {
                    balance_history: [
                        { date: "2024-03-08", value: 32.01 },
                        { date: "2024-03-09", value: 32.04 },
                        { date: "2024-03-10", value: 32.07 },
                        { date: "2024-03-11", value: 32.10 },
                        { date: "2024-03-12", value: 32.12 },
                        { date: "2024-03-13", value: 32.13 },
                        { date: "2024-03-14", value: 32.14 }
                    ],
                    inclusion_distance: 1.2,
                    sync_participation: 99.8,
                    head_distance: 1.0
                }
            }
        };

        // Store alert settings
        let alertSettings = {
            attestationThreshold: 95,
            balanceThreshold: 0.01,
            enableProposalAlerts: true
        };

        // Charts references
        let balanceChart, attestationChart, detailBalanceChart;

        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Initial update with mock data
            updateDashboard(mockData);

            // Setup charts
            setupCharts(mockData);

            // Setup event listeners
            setupEventListeners();

            // Setup tab system
            setupTabs();

            // Countdown for auto-refresh
            startRefreshCountdown();
        });

        // Update dashboard with new data
        function updateDashboard(data) {
            // Update timestamp
            document.getElementById('last-updated').textContent = new Date(data.timestamp).toLocaleString();

            // Update summary metrics
            document.getElementById('active-validators').textContent = data.active_validators;
            document.getElementById('attestation-rate').textContent = data.attestation_rate.toFixed(1) + '%';
            document.getElementById('avg-balance').textContent = data.avg_balance.toFixed(2) + ' ETH';
            document.getElementById('recent-proposals').textContent = data.recent_proposals;

            // Update trends
            const validatorTrendEl = document.getElementById('validator-trend');
            if (data.validator_trend > 0) {
                validatorTrendEl.className = 'metric-trend up';
                validatorTrendEl.innerHTML = `<i class="fas fa-arrow-up"></i> <span>+${data.validator_trend} this week</span>`;
            } else if (data.validator_trend < 0) {
                validatorTrendEl.className = 'metric-trend down';
                validatorTrendEl.innerHTML = `<i class="fas fa-arrow-down"></i> <span>${data.validator_trend} this week</span>`;
            } else {
                validatorTrendEl.className = 'metric-trend';
                validatorTrendEl.innerHTML = `<i class="fas fa-equals"></i> <span>No change</span>`;
            }

            const balanceTrendEl = document.getElementById('balance-trend');
            if (data.balance_trend > 0) {
                balanceTrendEl.className = 'metric-trend up';
                balanceTrendEl.innerHTML = `<i class="fas fa-arrow-up"></i> <span>+${data.balance_trend.toFixed(2)} this epoch</span>`;
            } else if (data.balance_trend < 0) {
                balanceTrendEl.className = 'metric-trend down';
                balanceTrendEl.innerHTML = `<i class="fas fa-arrow-down"></i> <span>${data.balance_trend.toFixed(2)} this epoch</span>`;
            } else {
                balanceTrendEl.className = 'metric-trend';
                balanceTrendEl.innerHTML = `<i class="fas fa-equals"></i> <span>No change</span>`;
            }

            // Update progress bars
            document.getElementById('attestation-progress').style.width = `${data.attestation_rate}%`;
            document.getElementById('missed-attestations').textContent = `${data.missed_attestations} missed`;
            document.getElementById('proposal-rate').textContent = `${data.proposal_rate}% success rate`;

            // Update advanced metrics
            document.getElementById('participation-rate').textContent = `${data.participation_rate}%`;
            document.getElementById('network-sync').textContent = data.network_sync;
            document.getElementById('inclusion-distance').textContent = data.inclusion_distance;

            // Update validator table
            updateValidatorTable(data.validators);

            // Update alerts
            updateAlerts(data.alerts);

            // Update charts if they exist
            updateCharts(data);
        }

        // Update the validator table with new data
        function updateValidatorTable(validators) {
            const tableBody = document.getElementById('validators-body');
            tableBody.innerHTML = '';

            validators.forEach(validator => {
                const row = document.createElement('tr');

                let statusClass = 'status-active';
                if (validator.status === 'pending') statusClass = 'status-pending';
                if (validator.status === 'error') statusClass = 'status-error';

                row.innerHTML = `
                    <td>${validator.index}</td>
                    <td><span class="status-indicator ${statusClass}"></span> ${validator.status}</td>
                    <td>${validator.balance.toFixed(2)} ETH</td>
                    <td>${validator.effectiveness}%</td>
                    <td>${validator.last_attestation}</td>
                    <td>${validator.proposals}</td>
                    <td>${validator.sync_participation}%</td>
                    <td>
                        <button class="action-button view-details" data-index="${validator.index}" style="padding: 5px 10px; font-size: 0.8rem;">
                            <i class="fas fa-info-circle"></i> Details
                        </button>
                    </td>
                `;

                tableBody.appendChild(row);
            });

            // Add event listeners to all detail buttons
            document.querySelectorAll('.view-details').forEach(button => {
                button.addEventListener('click', () => {
                    const validatorIndex = button.getAttribute('data-index');
                    showValidatorDetails(validatorIndex);
                });
            });
        }

        // Update alerts panel with new alerts
        function updateAlerts(alerts) {
            const alertsContainer = document.getElementById('alerts-container');
            alertsContainer.innerHTML = '';

            if (alerts.length === 0) {
                alertsContainer.innerHTML = `
                    <div class="alert-card" style="margin-bottom: 15px; padding: 15px; border-left: 4px solid #4caf50; background-color: #e8f5e9;">
                        <div class="alert-header" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <div class="alert-title" style="font-weight: 600; color: #2e7d32;">All Validators Healthy</div>
                            <div class="alert-timestamp" style="font-size: 0.8rem; color: #666;">${new Date().toLocaleString()}</div>
                        </div>
                        <div class="alert-message" style="color: #2e7d32;">
                            No alerts detected. All validators are performing normally.
                        </div>
                    </div>
                `;
            } else {
                let alertBadgeCount = 0;

                alerts.forEach(alert => {
                    let borderColor, bgColor, textColor;
                    switch (alert.severity) {
                        case 'critical':
                            borderColor = '#d32f2f';
                            bgColor = '#ffebee';
                            textColor = '#b71c1c';
                            alertBadgeCount++;
                            break;
                        case 'warning':
                            borderColor = '#ff9800';
                            bgColor = '#fff3e0';
                            textColor = '#e65100';
                            alertBadgeCount++;
                            break;
                        case 'info':
                        default:
                            borderColor = '#2196f3';
                            bgColor = '#e3f2fd';
                            textColor = '#0d47a1';
                            break;
                    }

                    alertsContainer.innerHTML += `
                        <div class="alert-card" style="margin-bottom: 15px; padding: 15px; border-left: 4px solid ${borderColor}; background-color: ${bgColor};">
                            <div class="alert-header" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <div class="alert-title" style="font-weight: 600; color: ${textColor};">${alert.title}</div>
                                <div class="alert-timestamp" style="font-size: 0.8rem; color: #666;">${new Date(alert.timestamp).toLocaleString()}</div>
                            </div>
                            <div class="alert-message" style="color: #333;">
                                ${alert.message}
                            </div>
                        </div>
                    `;
                });

                // Update the alert badge
                const alertBadge = document.getElementById('alert-badge');
                if (alertBadgeCount > 0) {
                    alertBadge.textContent = alertBadgeCount;
                    alertBadge.style.display = 'inline-block';
                } else {
                    alertBadge.style.display = 'none';
                }
            }
        }

        // Set up charts
        function setupCharts(data) {
            // Balance history chart
            const balanceCtx = document.getElementById('balance-chart').getContext('2d');
            balanceChart = new Chart(balanceCtx, {
                type: 'line',
                data: {
                    labels: data.balance_history.map(item => new Date(item.date).toLocaleDateString()),
                    datasets: [{
                        label: 'Average Balance (ETH)',
                        data: data.balance_history.map(item => item.value),
                        borderColor: '#6a5acd',
                        backgroundColor: 'rgba(106, 90, 205, 0.1)',
                        borderWidth: 2,
                        tension: 0.2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: Math.floor(Math.min(...data.balance_history.map(item => item.value)) * 0.99),
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(2) + ' ETH';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Balance: ${context.parsed.y.toFixed(3)} ETH`;
                                }
                            }
                        }
                    }
                }
            });

            // Attestation performance chart
            const attestationCtx = document.getElementById('attestation-chart').getContext('2d');
            attestationChart = new Chart(attestationCtx, {
                type: 'bar',
                data: {
                    labels: data.attestation_history.map(item => new Date(item.date).toLocaleDateString()),
                    datasets: [{
                        label: 'Attestation Rate (%)',
                        data: data.attestation_history.map(item => item.value),
                        backgroundColor: data.attestation_history.map(item =>
                            item.value >= 99 ? 'rgba(76, 175, 80, 0.7)' :
                            item.value >= 95 ? 'rgba(255, 152, 0, 0.7)' :
                            'rgba(244, 67, 54, 0.7)'
                        ),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 90,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Rate: ${context.parsed.y.toFixed(1)}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update charts with new data
        function updateCharts(data) {
            if (balanceChart) {
                balanceChart.data.labels = data.balance_history.map(item => new Date(item.date).toLocaleDateString());
                balanceChart.data.datasets[0].data = data.balance_history.map(item => item.value);
                balanceChart.update();
            }

            if (attestationChart) {
                attestationChart.data.labels = data.attestation_history.map(item => new Date(item.date).toLocaleDateString());
                attestationChart.data.datasets[0].data = data.attestation_history.map(item => item.value);
                attestationChart.data.datasets[0].backgroundColor = data.attestation_history.map(item =>
                    item.value >= 99 ? 'rgba(76, 175, 80, 0.7)' :
                    item.value >= 95 ? 'rgba(255, 152, 0, 0.7)' :
                    'rgba(244, 67, 54, 0.7)'
                );
                attestationChart.update();
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            // Refresh button
            document.getElementById('refresh-button').addEventListener('click', () => {
                // In a production environment, this would fetch fresh data from the API
                updateDashboard({
                    ...mockData,
                    timestamp: new Date().toISOString()
                });
                restartRefreshCountdown();
            });

            // Performance check button
            document.getElementById('performance-check').addEventListener('click', () => {
                alert('Performance check initiated. This would trigger a backend validator performance check in a production environment.');
                // In production, this would make an API call to run a performance check
            });

            // Export data button
            document.getElementById('export-data').addEventListener('click', () => {
                // In production, this would generate and download a report
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(mockData, null, 2));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "validator_report_" + new Date().toISOString().split('T')[0] + ".json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            });

            // Settings button
            document.getElementById('settings-button').addEventListener('click', () => {
                switchToTab('settings');
            });

            // Save settings button
            document.getElementById('save-settings').addEventListener('click', () => {
                alertSettings.attestationThreshold = parseInt(document.getElementById('attestation-threshold').value);
                alertSettings.balanceThreshold = parseFloat(document.getElementById('balance-threshold').value);
                alertSettings.enableProposalAlerts = document.getElementById('proposal-alert').checked;

                alert('Alert settings saved successfully!');
                // In production, this would save settings to local storage or send to backend
            });

            // Reset settings button
            document.getElementById('reset-settings').addEventListener('click', () => {
                document.getElementById('attestation-threshold').value = 95;
                document.getElementById('balance-threshold').value = 0.01;
                document.getElementById('proposal-alert').checked = true;

                alertSettings = {
                    attestationThreshold: 95,
                    balanceThreshold: 0.01,
                    enableProposalAlerts: true
                };

                alert('Alert settings reset to defaults.');
            });

            // Validator search
            document.getElementById('validator-search').addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const rows = document.querySelectorAll('#validators-body tr');

                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });

            // Close validator details panel
            document.getElementById('close-details').addEventListener('click', () => {
                document.getElementById('validator-details').classList.remove('active');
            });
        }

        // Set up tab system
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab-link');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    switchToTab(tabId);
                });
            });
        }

        // Switch to a specific tab
        function switchToTab(tabId) {
            // Remove active class from all tabs and content
            document.querySelectorAll('.tab-link').forEach(tab => {
                tab.classList.remove('active');
            });

            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Add active class to selected tab and content
            document.querySelector(`.tab-link[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(`${tabId}-tab`).classList.add('active');
        }

        // Show validator details
        function showValidatorDetails(validatorIndex) {
            const validator = mockData.validators.find(v => v.index == validatorIndex);
            const validatorDetails = mockData.validator_details[validatorIndex] || {
                balance_history: mockData.balance_history,
                inclusion_distance: 1.5,
                sync_participation: 99.0,
                head_distance: 1.3
            };

            if (!validator) return;

            // Update validator details panel
            document.getElementById('detail-validator-index').textContent = validator.index;
            document.getElementById('detail-status').textContent = validator.status;
            document.getElementById('detail-balance').textContent = validator.balance.toFixed(2);
            document.getElementById('detail-effectiveness').textContent = validator.effectiveness;
            document.getElementById('detail-last-attestation').textContent = validator.last_attestation;
            document.getElementById('detail-proposals').textContent = validator.proposals;
            document.getElementById('detail-inclusion').textContent = validatorDetails.inclusion_distance;
            document.getElementById('detail-sync').textContent = validatorDetails.sync_participation;
            document.getElementById('detail-head-distance').textContent = validatorDetails.head_distance;

            // Create or update chart
            if (detailBalanceChart) {
                detailBalanceChart.destroy();
            }

            const detailChartCtx = document.getElementById('detail-balance-chart').getContext('2d');
            detailBalanceChart = new Chart(detailChartCtx, {
                type: 'line',
                data: {
                    labels: validatorDetails.balance_history.map(item => new Date(item.date).toLocaleDateString()),
                    datasets: [{
                        label: `Validator #${validator.index} Balance (ETH)`,
                        data: validatorDetails.balance_history.map(item => item.value),
                        borderColor: '#6a5acd',
                        backgroundColor: 'rgba(106, 90, 205, 0.1)',
                        borderWidth: 2,
                        tension: 0.2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: Math.floor(Math.min(...validatorDetails.balance_history.map(item => item.value)) * 0.99),
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(2) + ' ETH';
                                }
                            }
                        }
                    }
                }
            });

            // Show the panel
            document.getElementById('validator-details').classList.add('active');
        }

        // Start the refresh countdown
        function startRefreshCountdown() {
            const countdownElement = document.getElementById('refresh-countdown');
            let countdown = 30;

            countdownElement.textContent = countdown;

            const interval = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;

                if (countdown <= 0) {
                    clearInterval(interval);
                    // In a real implementation, this would fetch fresh data
                    updateDashboard({
                        ...mockData,
                        timestamp: new Date().toISOString()
                    });
                    startRefreshCountdown();
                }
            }, 1000);
        }

        // Restart the refresh countdown
        function restartRefreshCountdown() {
            const countdownElement = document.getElementById('refresh-countdown');
            countdownElement.textContent = '30';
            // The existing interval will continue and reset when it reaches 0
        }
    </script>
</body>
</html>
