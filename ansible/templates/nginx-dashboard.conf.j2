# Nginx configuration for Ephemery Sync Dashboard
# Autogenerated by Ansible from nginx-dashboard.conf.j2

server {
    listen 80;
    server_name _;

    # Ephemery status dashboard
    location /ephemery-status/ {
        alias {{ ephemery_base_dir }}/data/monitoring/sync/dashboard/;
        index index.html;
        autoindex off;

        # Enable caching for static assets
        location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
            expires 7d;
            add_header Cache-Control "public";
        }

        # Allow CORS for API access
        location ~* \.(json)$ {
            expires -1;
            add_header Cache-Control "no-cache";
            add_header Access-Control-Allow-Origin "*";
            try_files $uri $uri/ =404;
        }
    }

    # Return 404 for all other requests to this server block
    location / {
        return 404;
    }

    # Basic security headers
    add_header X-Content-Type-Options "nosniff";
    add_header X-XSS-Protection "1; mode=block";
    add_header X-Frame-Options "SAMEORIGIN";
    add_header Referrer-Policy "strict-origin-when-cross-origin";
}
